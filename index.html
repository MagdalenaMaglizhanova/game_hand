<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gesture Flip Game</title>
  <style>
    body {
      background: #121212;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .deck {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }

    .card-container {
      perspective: 1000px;
    }

    .card {
      width: 120px;
      height: 160px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .card.flip {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      font-size: 3rem;
      border-radius: 12px;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .front {
      background: #444;
      color: white;
    }

    .back {
      background: white;
      color: black;
      transform: rotateY(180deg);
    }

    button {
      background: #00b894;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1.2rem;
      border-radius: 8px;
      cursor: pointer;
    }

    .result {
      margin-top: 20px;
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Repeat the Gesture Sequence</h1>

  <div class="deck" id="deck"></div>

  <button id="start">Start Game</button>
  <button id="submit" style="display:none;">Submit Gestures</button>

  <div class="result" id="result"></div>

  <!-- TensorFlow.js - –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–µ–Ω -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
<!-- Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <script>
    const gestures = ['‚úä', 'üñêÔ∏è', '‚òùÔ∏è'];
    const gestureLabels = ['fist', 'open', 'finger'];
    let sequence = [];
    let userInput = [];
    let model, webcam;

    const deck = document.getElementById('deck');
    const resultDiv = document.getElementById('result');
    const startBtn = document.getElementById('start');
    const submitBtn = document.getElementById('submit');

    async function initModel() {
      const URL = "model/";
      model = await tmImage.load(URL + "model.json", URL + "metadata.json");
      webcam = new tmImage.Webcam(200, 200, true);
      await webcam.setup();
      await webcam.play();
      document.body.appendChild(webcam.canvas); // –ø–æ–∫–∞–∑–≤–∞–º–µ –∫–∞–º–µ—Ä–∞—Ç–∞
      webcam.canvas.style.marginTop = "20px";
    }

    function createCard(emoji) {
      const container = document.createElement('div');
      container.className = 'card-container';

      const card = document.createElement('div');
      card.className = 'card';

      const front = document.createElement('div');
      front.className = 'card-face front';
      front.textContent = '?';

      const back = document.createElement('div');
      back.className = 'card-face back';
      back.textContent = emoji;

      card.appendChild(front);
      card.appendChild(back);
      container.appendChild(card);

      return { container, card };
    }

    async function showSequence() {
      deck.innerHTML = '';
      sequence = [];
      const cards = [];

      for (let i = 0; i < 3; i++) {
        const index = Math.floor(Math.random() * gestures.length);
        sequence.push(gestureLabels[index]);
        const { container, card } = createCard(gestures[index]);
        deck.appendChild(container);
        cards.push(card);
      }

      for (let i = 0; i < cards.length; i++) {
        await new Promise(r => setTimeout(r, 500));
        cards[i].classList.add('flip');
        await new Promise(r => setTimeout(r, 800));
        cards[i].classList.remove('flip');
      }

      submitBtn.style.display = 'inline-block';
    }

    async function getPrediction() {
      const predictions = await model.predict(webcam.canvas);
      predictions.sort((a, b) => b.probability - a.probability);
      return predictions[0].className;
    }

    async function captureGestures() {
      userInput = [];
      resultDiv.textContent = "Reading gestures...";

      for (let i = 0; i < 3; i++) {
        await new Promise(r => setTimeout(r, 1000));
        const gesture = await getPrediction();
        userInput.push(gesture);
      }

      checkResult();
    }

    function checkResult() {
      const win = sequence.every((g, i) => g === userInput[i]);
      if (win) {
        resultDiv.textContent = 'üéâ You win!';
        resultDiv.style.color = '#00e676';
      } else {
        resultDiv.textContent = '‚ùå Try again.';
        resultDiv.style.color = '#ff5252';
      }
    }

    startBtn.addEventListener('click', showSequence);
    submitBtn.addEventListener('click', captureGestures);

    initModel(); // –∑–∞—Ä–µ–∂–¥–∞–º–µ –º–æ–¥–µ–ª–∞ –∏ –∫–∞–º–µ—Ä–∞—Ç–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ
  </script>
</body>
</html>
